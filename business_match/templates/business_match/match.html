<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>T∆∞ v·∫•n ng√†nh n√™n kinh doanh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-oZ++E0FfFZzJ5Ge86vA0i8zaw3yfu5S+F3P+Qef0tlg=" crossorigin=""/>
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Montserrat', sans-serif;
    }
    h1, h2 {
      font-family: 'Symbol', serif;
      color: #0c1d4b;
    }
    .btn-primary {
      background-color: #0c1d4b;
      border-color: #0c1d4b;
    }
    .btn-primary:hover {
      background-color: #0a1636;
    }
    .highlight {
      padding: 2px 6px;
      border-radius: 4px;
      color: #fff;
      font-weight: 600;
    }
    .score-high { background-color: #0c1d4b; }
    .score-mid  { background-color: #fc9e19; }
    .score-low  { background-color: #ff4242; }
    .table thead {
      background-color: #0c1d4b;
      color: #fff;
    }
    #map {
      height: 400px;
    }
  </style>
</head>
<body>
<div class="container py-5">
  <h1 class="mb-4 text-center">üîç T∆∞ v·∫•n ng√†nh ph√π h·ª£p v·ªõi khu v·ª±c</h1>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form method="post" novalidate>
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-md-6">{{ form.address.label_tag }} {{ form.address }}</div>
          <div class="col-md-3">{{ form.radius.label_tag }} {{ form.radius }}</div>
          <div class="col-md-3">{{ form.customer_target.label_tag }} {{ form.customer_target }}</div>
          <div class="col-md-3">{{ form.price_min.label_tag }} {{ form.price_min }}</div>
          <div class="col-md-3">{{ form.price_max.label_tag }} {{ form.price_max }}</div>
        </div>
        <button class="btn btn-primary mt-3 w-100 fw-bold">
          üöÄ Ph√¢n t√≠ch & G·ª£i √Ω ng√†nh
        </button>
      </form>
    </div>
  </div>

  {% if results %}
  <div class="mb-3">
    {% if price_min or price_max %}
      <p class="text-muted small">
        üìå Gi√° m·ª•c ti√™u:
        {% if price_min %} t·ª´ <strong>{{ price_min }}</strong> {% endif %}
        {% if price_max %} ƒë·∫øn <strong>{{ price_max }}</strong> {% endif %}
      </p>
    {% endif %}
  </div>



  <h2 class="mt-4 mb-3">üìä K·∫øt qu·∫£ ch·∫•m ƒëi·ªÉm ng√†nh</h2>
  <div class="table-responsive">
    <table class="table table-bordered table-hover align-middle">
      <thead>
        <tr>
          <th>Ng√†nh</th>
          <th>ƒêi·ªÉm ph√π h·ª£p (%)</th>
          <th>Gi·∫£i th√≠ch</th>
          <th>C·∫£nh b√°o</th>
        </tr>
      </thead>
      <tbody>
        {% for r in results %}
        <tr>
          <td><strong>{{ r.name }}</strong></td>
          <td>
            <span class="highlight
              {% if r.score >= 60 %}score-high
              {% elif r.score >= 30 %}score-mid
              {% else %}score-low
              {% endif %}">
              {{ r.score }}
            </span>
          </td>
          <td>{{ r.reason }}</td>
          <td>
            {% if r.warnings %}
              <ul class="mb-0 ps-3">
                {% for w in r.warnings %}
                  <li>{{ w }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <span class="text-muted">Kh√¥ng</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-o9N1jvJ+F4jhWOU7ZMwTC92TQeP/d9vyvyehZ9v8z8M="
  crossorigin=""></script>
<script>
  const lat = {{ lat|default:"0" }};
  const lon = {{ lon|default:"0" }};
  if (lat && lon) {
    const map = L.map('map').setView([lat, lon], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);
    L.circle([lat, lon], {
      radius: {{ radius|default:2000 }},
      color: '#0c1d4b',
      fillColor: '#0c1d4b',
      fillOpacity: 0.2
    }).addTo(map).bindPopup("Trung t√¢m t√¨m ki·∫øm").openPopup();
  }
</script>
</body>
</html>